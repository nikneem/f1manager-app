parameters:
  azureSubscription: ''  # defaults for any parameters that aren't specified
  resourceGroupName: ''
  csmParametersFile: '' # a file name with extension
  artifactName: 'arm-templates'
  deploymentMode: "Incremental"

steps:
  - task: DownloadPipelineArtifact@0
    displayName: "Download Artifact: ${{parameters.artifactName}}"
    inputs:
      artifactName: "${{parameters.artifactName}}"
      targetPath: $(System.DefaultWorkingDirectory)/${{parameters.artifactName}}   

  - task: AzureResourceGroupDeployment@2
    displayName: 'ARM template deployment'
    inputs:
      azureSubscription: '${{parameters.azureSubscription}}'
      resourceGroupName: '${{parameters.resourceGroupName}}'
      csmFile: '$(System.DefaultWorkingDirectory)/${{parameters.artifactName}}/azuredeploy.json'
      csmParametersFile: '$(System.DefaultWorkingDirectory)/${{parameters.artifactName}}/${{parameters.csmParametersFile}}'
      deploymentMode: '${{parameters.deploymentMode}}'